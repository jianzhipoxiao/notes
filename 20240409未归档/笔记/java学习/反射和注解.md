####  反射

##### 1 Class的创建

三种创建方式

1. ```java
   Object obj  = new Object();
   
   Class c1 = obj.getClass();
   ```

2. ~~~java
    Class c2 = Object.class;
   ~~~

3. ~~~java
    Class c3 = Class.forName("java.lang.Object");
   ~~~



**常用第三种**

例子

~~~~java
public class ClassCreate {
    public static void main(String[] args) {
        Object obj  = new Object();

        Class c1 = obj.getClass();
        System.out.println("c1的哈希值为:"+c1.hashCode());

        Class c2 = Object.class;
        System.out.println("c2的哈希值为:"+c2.hashCode());

        try {
            Class c3 = Class.forName("java.lang.Object");
            System.out.println("c3的哈希值为:"+c3.hashCode());
            System.out.println(c1.equals(c2));
            System.out.println(c1.equals(c3));
            System.out.println(c3.equals(c2));
        } catch (ClassNotFoundException e) {
            e.printStackTrace();
        }
    }
}
~~~~

**运行效果**

![image-20221102180540856](D:\笔记\java\images\image-20221102180540856.png)

##### 1.2 Class常用方法及使用

| 方法                        | 参数                     | 返回值      | 效果                           |
| --------------------------- | ------------------------ | ----------- | ------------------------------ |
| c.getDeclaredConstructors() | 无                       | <> 泛型     | 返回全部构造方法               |
| c.getDeclaredConstructor()  | 目标类的构造方法参数类型 | Constructor | 返回指定构造方法               |
| c.getConstructors()         | 无                       | Constructor | 返回全部可访问到构造方法       |
| con.getModifiers()          | 无                       | int         | 返回构造方法修饰符如 public    |
| con.getName()               | 无                       | String      | 得到构造方法名称               |
| con.getParameterTypes       | 无                       | array       | 得到全部构造方法参数           |
| paras[i].getName()          | 无                       | String      | 得到构造方法参数类型名称全名   |
| paras[i].getSimpleName()    | 无                       | String      | 得到构造方法参数类型名称简化名 |
| cs1.newInstance()           | 构造方法，参数           | object      | 调用反射机制，实例化一个对象   |
| cs3.setAccessible(true)     | boolean                  | 无          | 获取权限[^ 私有构造方法]       |

**例子**

~~~java
import java.lang.reflect.Constructor;
import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Modifier;

public class get {
    public static void main(String[] args) {
        try {
            Class c = Class.forName("Example");
            Constructor cons[] = c.getDeclaredConstructors(); //全部
//            Constructor cons[] = c.getConstructors(); //可访问到的
            for (Constructor con: cons) {
                System.out.print(Modifier.toString(con.getModifiers()) +" ");

                System.out.print(con.getName()+'(');
                Class paras[] = con.getParameterTypes();
                for (int i = 0; i < paras.length; i++) {
//                    System.out.print(paras[i].getName()+" args ");
                    System.out.print(paras[i].getSimpleName()+" args ");
                    if (i< paras.length-1){
                        System.out.print(",");
                    }
                }
                System.out.println(") {  }");
            }

            Constructor cs1 = c.getDeclaredConstructor(); //获取无参构造
            Object obj = cs1.newInstance();
            System.out.println(obj.toString());

            Constructor cs2 = c.getDeclaredConstructor(int.class,String.class);
             obj = cs2.newInstance(12,"kyotaka");
            System.out.println(obj.toString());

            Constructor cs3 = c.getDeclaredConstructor(int.class,String.class,double.class);
            cs3.setAccessible(true);
            obj = cs3.newInstance(12,"fake",520.1);
            System.out.println(obj.toString());
        } catch (ClassNotFoundException e) {
            e.printStackTrace();
        } catch (NoSuchMethodException e) {
            e.printStackTrace();
        } catch (InvocationTargetException e) {
            e.printStackTrace();
        } catch (InstantiationException e) {
            throw new RuntimeException(e);
        } catch (IllegalAccessException e) {
            throw new RuntimeException(e);
        }
    }
}

~~~



**Example类代码**

~~~java
public class Example {
    int age;
    String name;
    double price;

    public Example() {

    }

    public Example(int age, String name) {
        this.age = age;
        this.name = name;
    }

    private Example(int age, String name, double price) {
        this.age = age;
        this.name = name;
        this.price = price;
    }

    @Override
    public String toString() {
        return "Example [age="+age+" , name = "+name+",price = "+price+"]";
    }
}

~~~



运行结果

![image-20221102191054481](D:\笔记\java学习\image-20221102191054481.png)

##### 2 Field 获取成员变量 

| 方法                  | 参数             | 返回值 | 效果                           |
| --------------------- | ---------------- | ------ | ------------------------------ |
| c.getDeclaredFields() | 无               | array  | 返回全部成员变量               |
| c.getFields()         | 无               | array  | 返回全部公有成员变量           |
| f.getModifiers()      | 无               | int    | 返回成员变量修饰符如 public    |
| f.getName()           | 无               | String | 得到成员变量名称               |
| f.getSimpleName()     | 无               | String | 得到成员变量参数类型名称简化名 |
| c.getDeclaredField()  | 无               | String | 得到指定成员变量               |
| f.get(e)              | 目标对象         | String | 得到构造方法参数类型名称简化名 |
| f.set(e,"world");     | 目标对象，修改值 | 无     | 修改成员变量值                 |
| f.setAccessible(true) | boolean          | 无     | 获取权限[^ 私有构造方法]       |

**例子**

~~~java
import java.lang.reflect.Constructor;
import java.lang.reflect.Field;
import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Modifier;

public class FiledTest {
    public static void main(String[] args) {
        try {
            Class c = Class.forName("Example2");
//            Field fs[] = c.getFields();
            Field fs[] = c.getDeclaredFields();
            for (Field f:fs){
                System.out.print(Modifier.toString(f.getModifiers())+" " );
//                System.out.print(f.getType().getName());
                System.out.print(f.getType().getSimpleName()+" ");
                System.out.print(f.getName());

                System.out.println();
            }

            Constructor cs = c.getConstructor();
            Example2 e = (Example2)cs.newInstance();
            Field f = c.getDeclaredField("name");
            System.out.print(f.getName() +" = ");
            System.out.println(f.get(e));
            f.set(e,"world");
            System.out.println("after set  "+f.getName()+" = "+f.get(e));


            Field f2 = c.getDeclaredField("age");
            System.out.print(f2.getName() +" = ");
            System.out.println(f2.get(e));
            Field f3 = c.getDeclaredField("price");
            f3.setAccessible(true);
            System.out.print(f3.getName() +" = ");
            System.out.println(f3.get(e));
        } catch (ClassNotFoundException e) {
            e.printStackTrace();
        } catch (NoSuchMethodException e) {
            e.printStackTrace();
        } catch (InvocationTargetException e) {
            e.printStackTrace();
        } catch (InstantiationException e) {
            throw new RuntimeException(e);
        } catch (IllegalAccessException e) {
            throw new RuntimeException(e);
        } catch (NoSuchFieldException e) {
            e.printStackTrace();
        }
    }
}

~~~

**Example2代码**

~~~jav
public class Example2 {
    public int age = 15;
    public String name = "hello";
    private double price = -1.1;
}
~~~



运行效果

![image-20221102200000727](D:\笔记\java学习\image-20221102200000727.png)

##### 3 Method 获取方法

##### 

| 方法                                           | 参数                          | 返回值       | 效果                       |
| ---------------------------------------------- | ----------------------------- | ------------ | -------------------------- |
| c.getDeclaredMethods()                         | 无                            | Mothed Array | 返回全部方法               |
| c.getDeclaredMethod("add",int.class,int.class) | 方法名，参数类型              | Mothed       | 获得指定方法               |
| m.getReturnType()                              | 无                            | String       | 得到方法返回值类型         |
| m.getExceptionTypes                            | 无                            | Class Array  | 得到方法抛出类型           |
| me.getModifiers()                              | 无                            | int          | 返回方法修饰符如 public    |
| m.getName()                                    | 无                            | String       | 得到方法名称               |
| m.getParameterTypes                            | 无                            | array        | 得到全部方法参数           |
| paras[i].getName()                             | 无                            | String       | 得到方法参数类型名称全名   |
| paras[i].getSimpleName()                       | 无                            | String       | 得到方法参数类型名称简化名 |
| m.setAccessible(true)                          | boolean                       | 无           | 获取权限[^ 私有方法]       |
| m.invoke(obj,-189,100);                        | 反射得到的实例化对象,方法参数 | 无           | 调用该方法                 |

**例子**

~~~java
import java.lang.reflect.Constructor;
import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;
import java.lang.reflect.Modifier;

public class MethodTest {
    public static void main(String[] args) {
        try {
            Class c = Class.forName("Example3");
            Method ms[] = c.getDeclaredMethods();
            for (Method me: ms){
                System.out.print(Modifier.toString(me.getModifiers())+" ");
                System.out.print(me.getReturnType().getSimpleName()+" ");
                System.out.print(me.getName()+" ( ");
                Class paras[] = me.getParameterTypes();
                for (int i = 0; i < paras.length; i++) {
                    System.out.print(paras[i].getSimpleName()+" arg ");
                    if (i < paras.length - 1){
                        System.out.print(",");
                    }
                }
                System.out.print(")");
                Class excs[] = me.getExceptionTypes();
                if (excs.length>0){
                    System.out.print(" throws ");
                }
                for (int i = 0; i < excs.length; i++) {
                    System.out.print(excs[i].getSimpleName());
                    if (i < excs.length - 1){
                        System.out.print(",");
                    }
                }
                System.out.println("{ }");
            }

            Constructor cs = c.getConstructor();
            Object obj = cs.newInstance();
            Method m = c.getDeclaredMethod("add", int.class, int.class);
            m.setAccessible(true);
            m.invoke(obj,-189,100);
        } catch (ClassNotFoundException e) {
            e.printStackTrace();
        } catch (NoSuchMethodException e) {
            e.printStackTrace();
        } catch (InvocationTargetException e) {
            e.printStackTrace();
        } catch (InstantiationException e) {
            e.printStackTrace();
        } catch (IllegalAccessException e) {
            e.printStackTrace();
        }
    }
}
~~~

**Example3代码**

~~~java
public class Example3 {
    private void add(int a, int b){
        System.out.println("a+b="+(a+b));
    }
}
~~~





**运行结果**

![image-20221103203232703](D:\笔记\java学习\image-20221103203232703.png)

#### 注解

##### 1内置注解

| 常用注解                    | 效果               |
| --------------------------- | ------------------ |
| @SuppressWarnings("unused") | 消除警告未使用     |
| @Deprecated                 | 已过时，不建议使用 |
| @Override                   | 重写               |

**例子**

~~~java
public class AnnotationTest {

    @SuppressWarnings("unused")
    String name;

    @Deprecated
    public void method(){

    }

    @SuppressWarnings("unused")
    public void hi(){

    }

    @Override
    public String toString() {
        return super.toString();
    }
}

~~~

![image-20221103204401116](D:\笔记\java学习\image-20221103204401116.png)

##### 2自定义注解

~~~java
public @interface MyAnnotation {
    String value() default "默认";
    Class type() default  void.class;
}
~~~

##### 反射注解

| 元注解                              | 效果                   |
| ----------------------------------- | ---------------------- |
| @Target(ElementType.FIELD)          | 注解用在那种文件上     |
| @Retention(RetentionPolicy.RUNTIME) | 注解用于JVM,可动态获取 |
|                                     |                        |

~~~java
public class CellPhone {
    @cellPhoneAnnotation (remakes = "品牌型号")
    public String brdMdl; //品牌型号
    @cellPhoneAnnotation (remakes = "价格")
    public double price; //价格
    @Deprecated
    @cellPhoneAnnotation(remakes = "电池接口",enable = false)
    public String BatteryInterface; //电池接口
    @cellPhoneAnnotation (remakes = "手机厂商")
    public String manufacturer;//手机厂商
}

~~~

~~~java
import java.lang.reflect.Field;

public class Main {
    public static void main(String[] args) {
        Class c =CellPhone.class;
        Field fs[] = c.getDeclaredFields();
        for (Field f : fs){
          if (f.isAnnotationPresent(cellPhoneAnnotation.class)){
            cellPhoneAnnotation p =f.getAnnotation(cellPhoneAnnotation.class);
            System.out.print(f.getName()+"属性注释内容为： ");
            System.out.print("备注="+p.remakes());
            System.out.println("  属性是否启用="+p.enable());
          }
        }

    }
}
~~~

~~~jade
import java.lang.annotation.ElementType;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Target;

@Target(ElementType.FIELD)
@Retention(RetentionPolicy.RUNTIME)
public @interface cellPhoneAnnotation {
    String remakes() default "";

    boolean enable() default true;
}

~~~

![image-20221103213011485](D:\笔记\java学习\image-20221103213011485.png)