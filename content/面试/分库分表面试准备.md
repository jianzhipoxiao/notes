### 分库分表面试准备

#### 简单技术问题：

1. 为什么要自研，市面不是有吗，怎么回答？
   - 可以从以下3个点解答；
   - 1. 维护性；市面的路由组件比如 shardingsphere 但过于庞大，还需要随着版本做一些升级。而我们需要更少的维护成本。
     2.  扩展性；结合自身的业务需求，我们的路由组件可以分库分表、自定义路由协议，扫描指定库表数据等各类方式。研发扩展性好，简单易用。 
     3. 安全性；自研的组件更好的控制了安全问题，不会因为一些额外引入的jar包，造成安全风险。 当然，我们的组件主要是为了更好的适应目前系统的诉求，所以使用自研的方式处理。就像shardingsphere 的市场占有率也不是 100% 那么肯定还有很多公司在自研，甚至各个大厂也都自研一整套分布式服务，来让自己的系统更稳定的运行。
2. 分库分表基本是单表200万，才分， 你们为什么分库分表？ 
   - 1. 我们分库分表用的非常熟。但不能为了等到系统到了200万数据，才拆。那么工作量会非常大
     2.  我们的做法是，因为有成熟方案，所以前期就分库分表了。但，为了解释服务器空间。所以把分库分表的库，用服务器虚拟出来机器安装。这样即不过多的占用服务器资源，也方便后续数据量真的上来了，好拆分。
     3.   同时，抽奖系统，是瞬时峰值较高的系统，历史数据不一定多。所以我们希望，用户可以快速的检索到个人数据，做最优响应。因为大家都知道，抽奖这东西，push发完，基本就1~3分钟结束，10分钟人都没了。所以我们这也是做了分库分表的理由。

3. 什么是 AOP？在 DB-Router 中如何应用 AOP？
4.   AbstractRoutingDataSource 是什么？它的作用是什么？ 
5. ThreadLocal 是什么？在 DB-Router 中是如何使用的？ 
6.  什么是哈希散列？在 DB-Router 中为什么选择了哈希散列算法？ 
7. SAC 测试是什么？在 DB-Router 中如何应用 SAC 测试？ 

#### 中等技术问题：

1. 什么是 MyBatis Plugin？在 DB-Router 中如何应用 MyBatis Plugin 实现动态变更表信息？ 

   DB-Router 基于 MyBatis 插件拦截机制，获取 SQL 信息，并进行修改操作。主要涉及MyBatis源码类；StatementHandler - 语句处理器、MetaObject - 元对象、MappedStatement 映射语句对象。

2.  分库分表的散列算法有哪些，各自的优缺点是什么？

3.   在 DB-Router 中如何支持个性化的分库分表控制？请结合具体实例说明。

   DB-Router 用户可以自己实现散列算法，比如使用一个字段分库、一个字段分表。实现后替换现有散列算法配置进去就可以。

4.   在 DB-Router 中如何实现扩展监控、扫描、策略等规则？ 

    DB-Router 可以与监控服务配合，在路由执行时，在方法上添加监控配置信息。一般是一个key。这里通过key与对应的方法名称组合出唯一值，来监控路由方法的执行。包括耗时、异常等信息。

5.  什么是雪崩测试？在 DB-Router 中如何进行雪崩测试？

####  难度技术问题：

1. 在 DB-Router 的架构模型中，如何实现扩展性和灵活性的平衡？ 

    DB-Router 可以支持数据源的设计、多种散列算法的自定义实现

2. 在 DB-Router 中如何保证数据路由的高效性和准确性？

   早期对用户的id设计长短、字符类型、特殊字符、纯数字等，都无限制，因此路由的时可能会有偏差。为此通过将路由字段统一截取到固定长度，在进行路由会更加准确。同时也保证计算的高效性。

3. 在 DB-Router 中，如何避免分库分表后产生的性能问题？

    DB-Router 的性能主要体现在路由计算、切换数据源、更改SQL，此逻辑操作在进行压测下，平均只需要2~4毫秒左右，因此不会对性能造成影响。

4. 在 DB-Router 中如何应对高并发的场景？请结合具体实例说明。 

   DB-Router 高并发场景需要注意在应用分布式部署后，数据库的连接数也应随之配置，同时注意配置路由的连接池需要根据业务场景进行验证压测。另外尽量必要做过大的事务，这样会长时间占用数据库资源。

5. 在 DB-Router 的设计过程中，遇到了哪些技术难点？是如何解决的？